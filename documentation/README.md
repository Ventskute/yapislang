# Лабораторная работа №2

## Введение

***Разработка документации языка***

Данная документация разработана студенткой группы 821703 Венцкуте В.

Здесь и далее описывается структура языка с рабочим названием Yapislang, разработанного в ходе выполнения лабораторной работы №1.

## Yapislang

### Применение

Данный язык разрабатывался как универсальный язык для работы со строковыми данными, такими как `char`, `string`, и массив `string`.

### Синтаксис

#### Ключевые слова

В Yapislang поддерживаются следующие ключевые слова:
- `func` -- ключевое слово, позволяющее определить новую функцию
- `char` -- ключевое слово, определяющее символьный тип данных (например, `"a"`)
- `string` -- ключевое слово, определяющее строковый тип данных (например, `"abc"`)
- `string[]` -- ключевое слово, определяющее тип данных, представляющий собой массив строк (например, `["aaa", "bbb", "ccc"]`)
- `int` -- ключевое слово, определяющее целочисленный тип данных (например, `2` - индекс символа в строке)
- `bool` -- ключевое слово, определяющее булевый (логический) тип данных (например, `true` - индикатор нахождения строки в массиве)
- `return` -- ключевое слово, описывающее возврат значения из функции

#### Объявление переменных

В Yapislang переменные могут объявляться в виде выражения объявления переменной, имеющего следующий вид:  
```go
тип_данных идентификатор (= значение)?
```  
Например,  
```go
string a = "some cool string"
```

Наравне с объявлениями переменных имеют место объявления функций с помощью ключевого слова `func` в следующем виде:  
```go
тип_возвращаемых_данных func идентификатор (список_параметров?) тело_функции
```  
Например,  
```go
string func foo() {}
```

#### Выражения

Yapislang поддерживает следующие виды выражений:
- вызов функции (`foo()`)
- явное приведение типа (`(string)charVar`)
- обращение к составным элементам типов по индексу (`stringVar[0]`)
- выражения с унарными операторами `++`, `--`, `!` (`a++` `--a`)
- выражения с бинарными операторами `+`, `-`, `*`, `/`, `>`, `<`, `==`, `>=` `<=` (`i >= 2`)
- выражения с бинарными логическими операторами `&&`, `||` (`a && b`)
- идентификатор (`foo`)
- литерал (`"abc"`)

#### Утверждения

Yapislang поддерживает следующие виды утверждений:
- variable statement
- expression statement
- if statement
- iteration statement
- return statement
- function declaration

#### Условные переходы

Условные переходы в Yapislang могут быть реализованы двумя способами
1. С помощью оператора `if... else`
2. С помощью неявного приведения типов в виде `a && b`, где b выполняется тогла, когда `a` приводится к `bool true`

#### Циклы

Поскольку Yapislang был разработан специально для работы со строками, то циклы были реализованы в ограниченном объеме. Цикл в Yapislang реализуется в следующем виде:  
```go
for (char a in str) {}
```
или  
```go
for (string s in arr) {}
```

### Описания базовых возможностей языка
#### Стандартные функции

Для работы со строками наиболее важной функцией стандартной области имен являются:
- функция `print`, имеющая следующую сигнатуру:  
`print(строка|число|bool)`  
или  
`print(s)`
- функция `substr`, позволяющая получить подстроку, со следующей сигнатурой:  
`substr(строка, начало, конец?)`  
или  
`substr(s, 2, 5)`
- функция `length`, позволяющая получить длину строки или массива, со следующей сигнатурой:  
`length(строка|массив)`  
или  
`length(str)`

#### Примеры кода

```go
string html = "<div>some text</div>"

string[] func parseHTML(string html) {
  string[] result = []

  string[] arr = html.toArray()    // ["<", "d", "i", "v", ">", "s"...]

  string temp = ""

  for (string symbol in arr) {
    if (symbol == "<") {          // tag found
      int slash = arr.find("/")    // search for closing tag

      if (slash == 1) {          // if tag is closing </div>
        result.push(temp)        // push text to result
        temp = ""                // empty temp text
      }

      int index = arr.find(">")                // find closing of tag
      string tag = html.substr(0, index)      // get tag
      result.push(tag)                        // push tag in result
      html = html.substr(index)                // cut string
    } else {
      temp = temp + symbol            // if symbol is not a tag
      html = html.substr(1)            // add it to temp string
    }
  }

  return result
}

string[] parsed = parseHTML(html)    // ["<div>", "some text", "</div>"]
```
### Описание принципов работы языка

Yapislang работает по принципам максимальной универсальности и полезности при простом синтаксисе. Для этого была реализована полноценная грамматика и синтаксис для ANTLR4, подразумевающая возможность дальнейшего расширения.

#### Процесс компиляции

Исходный код компилируется напрямую в байткод с помощью LLVM IR, или промежуточного представления низкоуровневой виртуальной машины. Промежуточные правила компиляции реализованы с помощью наиболее близкого Yapislang по духу языка - Javascript, который в свою очередь формирует LLVM IR и преобразует его в байткод для записи в исполняемый файл.

#### Особенности скомпилированного кода

Скомпилированный байткод не является исполняемой программой, однако может быть скомпилирован в исполняемый файл для ОС семеств Windows, Linux и macOS с помощью соответствующих компиляторов (например, clang).